{% extends 'usuarios/layout/base_usuarios.html' %}


{% block contenido_main %}

{% include 'usuarios/components/mensajes_error_confirm_new_password.html'%}

<style>
    .error-message {
        color: #B3261E;
        font-size: 13px;
    }
</style>


<h2 class="text-center fw-bold">Restablecer contraseña</h2>
<div class="py-4 container" style="max-width: 400px; width: 100%;">
    <p>
        Ingrese y confirme su nueva contraseña para completar el restablecimiento.
    </p>

    <form id="setPasswordForm" method="post">
        {% csrf_token %}
        
        <!-- Campo de nueva contraseña -->
        <div class="form-floating mb-4">
            <input type="password" name="{{ form.new_password1.name }}" id="{{ form.new_password1.id_for_label }}" class="form-control fw-bold" placeholder="Nueva contraseña" required>
            <label class="fw-bold" for="{{ form.new_password1.id_for_label }}" style="font-size: 14px">Nueva contraseña</label>
            <div class="position-relative ms-3">
                <div id="newPassword1Error" class="error-message position-absolute"></div>
            </div>
        </div>

        <!-- Campo de confirmación de contraseña -->
        <div class="form-floating mb-4">
            <input type="password" name="{{ form.new_password2.name }}" id="{{ form.new_password2.id_for_label }}" class="form-control fw-bold" placeholder="Confirmar nueva contraseña" required>
            <label class="fw-bold" for="{{ form.new_password2.id_for_label }}" style="font-size: 14px">Confirmar nueva contraseña</label>
            <div class="position-relative ms-3">
                <div id="newPassword2Error" class="error-message position-absolute"></div>
            </div>
        </div>

        <button class="btn btn-primary w-100 mt-1" type="submit">Actualizar contraseña</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('setPasswordForm');
        const new_password1 = form.querySelector('#id_new_password1');
        const new_password2 = form.querySelector('#id_new_password2');

        const newPassword1Error= document.getElementById('newPassword1Error');
        const newPassword2Error = document.getElementById('newPassword2Error');
    
        function validateNewPassword1() {
            if (new_password1.value.length < 8) {
                newPassword1Error.textContent = 'La contraseña debe tener al menos 8 caracteres.';
            } else {
                newPassword1Error.textContent = '';
            }
        }
    
        function validateNewPassword2() {
            if (new_password2.value !== new_password1.value) {
                newPassword2Error.textContent = 'Las contraseñas no coinciden.';
            } else {
                newPassword2Error.textContent = '';
            }
        }
    
        // Escuchar eventos en tiempo real
        new_password1.addEventListener('input', validateNewPassword1);
        new_password2.addEventListener('input', validateNewPassword2);
    
        // Validación final al enviar el formulario
        form.addEventListener('submit', function (event) {
            validateNewPassword1();
            validateNewPassword2();
    
            if (
                newPassword1Error.textContent ||
                newPassword2Error.textContent
            ) {
                event.preventDefault(); // Evita el envío si hay errores
            }
        });
    });
</script>

{% endblock contenido_main %}


