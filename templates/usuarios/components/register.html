{% load static %}

{% include 'usuarios/components/mensajes_error_registro.html' %}

<style>
    .error-message {
        color: #B3261E;
        font-size: 13px;
    }
</style>




<h2 class="text-center fw-bold">Registro de Usuario</h2>
<div class="container text-center">
    <img src="{% static 'src/core/image/usuario_dif_color.svg' %}" alt="Logo" width="120" height="120"
        class="d-inline-block align-text-top">
</div>
<div class="py-4 container" style="max-width: 400px; width: 100%;">
    <form id="registerForm" method="post" action="{% url 'register_page' %}">
        {% csrf_token %}

        <!-- Campo de nombre de usuario -->
        <div class="form-floating mb-4">
            {{ form.username }}
            <label class="fw-bold" for="{{ form.username.id_for_label }}" style="font-size: 14px;">Usuario</label>
            <div class="position-relative ms-3">
                <div id="usernameError" class="error-message position-absolute"></div>
            </div>
        </div>

        <!-- Campo de email -->
        <div class="form-floating mb-4">
            {{ form.email }}
            <label class="fw-bold" for="{{ form.email.id_for_label }}" style="font-size: 14px;">Correo electrónico</label>
            <div class="position-relative ms-3">
                <div id="emailError" class="error-message position-absolute"></div>
            </div>
        </div>

        <!-- Campo de contraseña -->
        <div class="form-floating mb-4">
            {{ form.password1 }}
            <label class="fw-bold" for="{{ form.password1.id_for_label }}" style="font-size: 14px;">Contraseña</label>
            <div class="position-relative ms-3">
                <div id="password1Error" class="error-message position-absolute"></div>
            </div>
        </div>

        <!-- Campo de confirmación de contraseña -->
        <div class="form-floating mb-4">
            {{ form.password2 }}
            <label class="fw-bold" for="{{ form.password2.id_for_label }}" style="font-size: 14px;">Confirmar contraseña</label>
            <div class="position-relative ms-3">
                <div id="password2Error" class="error-message position-absolute"></div>
            </div>
        </div>


        <!-- Botón Registrar -->
        <button class="btn btn-primary w-100 mt-1" type="submit">Registrarse</button>
    </form>
</div>

<!-- Ir a Login Usuario -->
<div class="container d-flex justify-content-center text-center fw-bold">
    <a class="me-2" style="text-decoration: none; color: #212529; font-weight: bold" href="{% url 'login_page' %}">¿Ya
        tienes una cuenta?</a>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('registerForm');
        const username = form.querySelector('#id_username');
        const email = form.querySelector('#id_email');
        const password1 = form.querySelector('#id_password1');
        const password2 = form.querySelector('#id_password2');
    
        const usernameError = document.getElementById('usernameError');
        const emailError = document.getElementById('emailError');
        const password1Error = document.getElementById('password1Error');
        const password2Error = document.getElementById('password2Error');
    
        // Validaciones
        function validateUsername() {
            if (username.value.trim() === '') {
                usernameError.textContent = 'El nombre de usuario es obligatorio.';
            } else {
                usernameError.textContent = '';
            }
        }
    
        function validateEmail() {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email.value.trim() === '') {
                emailError.textContent = 'El correo electrónico es obligatorio.';
            } else if (!emailPattern.test(email.value)) {
                emailError.textContent = 'El correo electrónico no es válido.';
            } else {
                emailError.textContent = '';
            }
        }
    
        function validatePassword1() {
            if (password1.value.length < 8) {
                password1Error.textContent = 'La contraseña debe tener al menos 8 caracteres.';
            } else {
                password1Error.textContent = '';
            }
        }
    
        function validatePassword2() {
            if (password2.value !== password1.value) {
                password2Error.textContent = 'Las contraseñas no coinciden.';
            } else {
                password2Error.textContent = '';
            }
        }
    
        // Escuchar eventos en tiempo real
        username.addEventListener('input', validateUsername);
        email.addEventListener('input', validateEmail);
        password1.addEventListener('input', validatePassword1);
        password2.addEventListener('input', validatePassword2);
    
        // Validación final al enviar el formulario
        form.addEventListener('submit', function (event) {
            validateUsername();
            validateEmail();
            validatePassword1();
            validatePassword2();
    
            if (
                usernameError.textContent ||
                emailError.textContent ||
                password1Error.textContent ||
                password2Error.textContent
            ) {
                event.preventDefault(); // Evita el envío si hay errores
            }
        });
    });
    
    
</script>